# üöÄ Oracle VPS Ubuntu Deployment Rehberi

Bu rehber, Document Management System projesini Oracle Cloud VPS'te Ubuntu 22.04 √ºzerinde canlƒ±ya almak i√ßin gerekli t√ºm adƒ±mlarƒ± i√ßerir.

## üìã ƒ∞√ßindekiler

1. [Oracle VPS Hazƒ±rlƒ±ƒüƒ±](#oracle-vps-hazƒ±rlƒ±ƒüƒ±)
2. [Ubuntu Server Kurulumu](#ubuntu-server-kurulumu)
3. [Gerekli Yazƒ±lƒ±mlarƒ± Y√ºkleme](#gerekli-yazƒ±lƒ±mlarƒ±-y√ºkleme)
4. [MySQL Kurulumu](#mysql-kurulumu)
5. [Backend Deployment](#backend-deployment)
6. [Frontend Deployment](#frontend-deployment)
7. [Nginx Konfig√ºrasyonu](#nginx-konfig√ºrasyonu)
8. [SSL Certificate](#ssl-certificate)
9. [Firewall ve G√ºvenlik](#firewall-ve-g√ºvenlik)
10. [Monitoring ve Backup](#monitoring-ve-backup)

---

## üîß Oracle VPS Hazƒ±rlƒ±ƒüƒ±

### 1. Oracle Cloud Instance Olu≈ütur

```bash
# Oracle Cloud Console'da:
# - Compute > Instances > Create Instance
# - Shape: VM.Standard.E2.1.Micro (Always Free)
# - Image: Ubuntu 22.04 LTS
# - Boot Volume: 50GB
# - Network: Public IP assign et
# - SSH Keys: Public key'ini ekle
```

### 2. SSH Baƒülantƒ±sƒ±

```bash
# Local makinenden VPS'e baƒülan
ssh -i ~/.ssh/your-private-key ubuntu@your-vps-ip

# ƒ∞lk baƒülantƒ±da sistem g√ºncellemesi
sudo apt update && sudo apt upgrade -y
```

---

## üñ•Ô∏è Ubuntu Server Kurulumu

### 1. Sistem G√ºncellemesi

```bash
# Paket listesini g√ºncelle
sudo apt update

# Sistemƒ± g√ºncelle
sudo apt upgrade -y

# Gerekli temel paketleri y√ºkle
sudo apt install -y curl wget git unzip software-properties-common apt-transport-https ca-certificates gnupg lsb-release
```

### 2. Swap Dosyasƒ± Olu≈ütur (Opsiyonel)

```bash
# 2GB swap dosyasƒ± olu≈ütur
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# Kalƒ±cƒ± hale getir
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
```

---

## üì¶ Gerekli Yazƒ±lƒ±mlarƒ± Y√ºkleme

### 1. .NET 8 Runtime Kurulumu

```bash
# Microsoft paket repository'sini ekle
wget https://packages.microsoft.com/config/ubuntu/22.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb
sudo dpkg -i packages-microsoft-prod.deb
rm packages-microsoft-prod.deb

# .NET 8 Runtime ve SDK y√ºkle
sudo apt update
sudo apt install -y aspnetcore-runtime-8.0 dotnet-sdk-8.0

# Kurulumu doƒürula
dotnet --version
```

### 2. Node.js Kurulumu

```bash
# NodeSource repository ekle
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -

# Node.js y√ºkle
sudo apt install -y nodejs

# Kurulumu doƒürula
node --version
npm --version
```

### 3. Nginx Kurulumu

```bash
# Nginx y√ºkle
sudo apt install -y nginx

# Nginx'i ba≈ülat ve enable et
sudo systemctl start nginx
sudo systemctl enable nginx

# Status kontrol et
sudo systemctl status nginx
```

---

## üóÑÔ∏è MySQL Kurulumu

### 1. MySQL Server Kurulumu

```bash
# MySQL Server y√ºkle
sudo apt install -y mysql-server

# MySQL'i ba≈ülat ve enable et
sudo systemctl start mysql
sudo systemctl enable mysql

# G√ºvenlik konfig√ºrasyonu
sudo mysql_secure_installation
```

### 2. Database ve User Olu≈ütur

```bash
# MySQL'e root olarak baƒülan
sudo mysql -u root -p

# Database olu≈ütur
CREATE DATABASE DocumentManagementDB CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# User olu≈ütur ve yetki ver
CREATE USER 'docuser'@'localhost' IDENTIFIED BY 'VeryStrongPassword123!';
GRANT ALL PRIVILEGES ON DocumentManagementDB.* TO 'docuser'@'localhost';
FLUSH PRIVILEGES;

# √áƒ±kƒ±≈ü
EXIT;

# Baƒülantƒ±yƒ± test et
mysql -u docuser -p DocumentManagementDB
```

---

## üîß Backend Deployment

### 1. Proje Dosyalarƒ±nƒ± Y√ºkle

```bash
# Proje klas√∂r√º olu≈ütur
sudo mkdir -p /var/www/document-management
sudo chown -R $USER:$USER /var/www/document-management

# Git ile projeyi clone et (veya SCP ile dosyalarƒ± kopyala)
cd /var/www/document-management
git clone https://github.com/your-username/document-management.git .

# Veya local'den dosyalarƒ± kopyala
# scp -r -i ~/.ssh/your-key ./DocumentManagementAPI ubuntu@your-vps-ip:/var/www/document-management/
```

### 2. Backend Build

```bash
# Backend klas√∂r√ºne git
cd /var/www/document-management/DocumentManagementAPI

# Dependencies restore et
dotnet restore

# Production build
dotnet publish -c Release -o /var/www/document-management/api

# Uploads klas√∂r√º olu≈ütur
mkdir -p /var/www/document-management/api/uploads
mkdir -p /var/www/document-management/api/logs
```

### 3. Production Configuration

```bash
# Production appsettings olu≈ütur
sudo nano /var/www/document-management/api/appsettings.Production.json
```

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=localhost;Database=DocumentManagementDB;User=docuser;Password=VeryStrongPassword123!;"
  },
  "JwtSettings": {
    "SecretKey": "your-super-secure-production-secret-key-at-least-32-characters-long-change-this-now",
    "Issuer": "DocumentManagementAPI",
    "Audience": "DocumentManagementClient",
    "ExpiryMinutes": 1440
  },
  "Logging": {
    "LogLevel": {
      "Default": "Warning",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "yourdomain.com,www.yourdomain.com,your-vps-ip"
}
```

### 4. Database Migration

```bash
# Migration √ßalƒ±≈ütƒ±r
cd /var/www/document-management/api
dotnet DocumentManagementAPI.dll --migrate

# Veya EF Core tools ile
# dotnet ef database update --project /var/www/document-management/DocumentManagementAPI
```

### 5. Systemd Service Olu≈ütur

```bash
# Service dosyasƒ± olu≈ütur
sudo nano /etc/systemd/system/document-management.service
```

```ini
[Unit]
Description=Document Management API
After=network.target

[Service]
Type=notify
ExecStart=/usr/bin/dotnet /var/www/document-management/api/DocumentManagementAPI.dll
Restart=always
RestartSec=10
KillSignal=SIGINT
SyslogIdentifier=document-management
User=www-data
Environment=ASPNETCORE_ENVIRONMENT=Production
Environment=DOTNET_PRINT_TELEMETRY_MESSAGE=false
WorkingDirectory=/var/www/document-management/api

[Install]
WantedBy=multi-user.target
```

```bash
# Service'i enable et ve ba≈ülat
sudo systemctl daemon-reload
sudo systemctl enable document-management
sudo systemctl start document-management

# Status kontrol et
sudo systemctl status document-management

# Logs kontrol et
sudo journalctl -u document-management -f
```

---

## üåê Frontend Deployment

### 1. Frontend Build

```bash
# Frontend klas√∂r√ºne git
cd /var/www/document-management

# Production environment ayarla
echo "VITE_API_BASE_URL=https://yourdomain.com/api" > .env.production

# Dependencies y√ºkle
npm install

# Production build
npm run build

# Build dosyalarƒ±nƒ± nginx klas√∂r√ºne kopyala
sudo mkdir -p /var/www/html/document-management
sudo cp -r dist/* /var/www/html/document-management/
```

### 2. Permissions Ayarla

```bash
# Dosya sahipliklerini ayarla
sudo chown -R www-data:www-data /var/www/document-management
sudo chown -R www-data:www-data /var/www/html/document-management

# Permissions ayarla
sudo chmod -R 755 /var/www/document-management
sudo chmod -R 755 /var/www/html/document-management
sudo chmod -R 777 /var/www/document-management/api/uploads
sudo chmod -R 777 /var/www/document-management/api/logs
```

---

## ‚öôÔ∏è Nginx Konfig√ºrasyonu

### 1. Nginx Site Konfig√ºrasyonu

```bash
# Site konfig√ºrasyon dosyasƒ± olu≈ütur
sudo nano /etc/nginx/sites-available/document-management
```

```nginx
# HTTP to HTTPS redirect
server {
    listen 80;
    server_name yourdomain.com www.yourdomain.com your-vps-ip;
    return 301 https://$server_name$request_uri;
}

# HTTPS Configuration
server {
    listen 443 ssl http2;
    server_name yourdomain.com www.yourdomain.com;
    
    # SSL Configuration (Let's Encrypt certificates)
    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    
    # Security Headers
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-Frame-Options DENY always;
    add_header X-Content-Type-Options nosniff always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    
    # File upload size
    client_max_body_size 100M;
    
    # Frontend (React App)
    location / {
        root /var/www/html/document-management;
        index index.html;
        try_files $uri $uri/ /index.html;
        
        # Cache static assets
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
    
    # API Backend
    location /api/ {
        proxy_pass http://localhost:5000/api/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection keep-alive;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # Timeouts
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # File upload endpoint (extended timeout)
    location /api/documents/upload {
        proxy_pass http://localhost:5000/api/documents/upload;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Extended timeouts for file uploads
        proxy_connect_timeout 300s;
        proxy_send_timeout 300s;
        proxy_read_timeout 300s;
        client_max_body_size 100M;
    }
}

# IP-based access (for initial setup)
server {
    listen 80;
    server_name your-vps-ip;
    
    location / {
        root /var/www/html/document-management;
        index index.html;
        try_files $uri $uri/ /index.html;
    }
    
    location /api/ {
        proxy_pass http://localhost:5000/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### 2. Site'ƒ± Enable Et

```bash
# Site'ƒ± enable et
sudo ln -s /etc/nginx/sites-available/document-management /etc/nginx/sites-enabled/

# Default site'ƒ± disable et
sudo rm /etc/nginx/sites-enabled/default

# Nginx konfig√ºrasyonunu test et
sudo nginx -t

# Nginx'i restart et
sudo systemctl restart nginx
```

---

## üîí SSL Certificate (Let's Encrypt)

### 1. Certbot Kurulumu

```bash
# Certbot y√ºkle
sudo apt install -y certbot python3-certbot-nginx

# SSL certificate al (domain'in DNS'i VPS IP'sine y√∂nlendirilmi≈ü olmalƒ±)
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com

# Auto-renewal test et
sudo certbot renew --dry-run

# Crontab'a auto-renewal ekle
echo "0 12 * * * /usr/bin/certbot renew --quiet" | sudo crontab -
```

### 2. SSL Konfig√ºrasyonunu Test Et

```bash
# SSL test et
curl -I https://yourdomain.com

# Certificate bilgilerini kontrol et
openssl s_client -connect yourdomain.com:443 -servername yourdomain.com
```

---

## üî• Firewall ve G√ºvenlik

### 1. UFW Firewall Kurulumu

```bash
# UFW y√ºkle ve enable et
sudo apt install -y ufw

# Default policies
sudo ufw default deny incoming
sudo ufw default allow outgoing

# SSH, HTTP, HTTPS portlarƒ±nƒ± a√ß
sudo ufw allow ssh
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# MySQL portunu sadece localhost'a a√ß (opsiyonel)
sudo ufw allow from 127.0.0.1 to any port 3306

# Firewall'ƒ± enable et
sudo ufw enable

# Status kontrol et
sudo ufw status verbose
```

### 2. Oracle Cloud Security List

```bash
# Oracle Cloud Console'da:
# Networking > Virtual Cloud Networks > Your VCN > Security Lists
# Ingress Rules ekle:
# - Port 80 (HTTP): 0.0.0.0/0
# - Port 443 (HTTPS): 0.0.0.0/0
# - Port 22 (SSH): Your IP/32 (g√ºvenlik i√ßin sadece kendi IP'n)
```

### 3. Fail2Ban Kurulumu

```bash
# Fail2ban y√ºkle
sudo apt install -y fail2ban

# Nginx i√ßin jail konfig√ºrasyonu
sudo nano /etc/fail2ban/jail.local
```

```ini
[DEFAULT]
bantime = 3600
findtime = 600
maxretry = 5

[nginx-http-auth]
enabled = true

[nginx-limit-req]
enabled = true
filter = nginx-limit-req
action = iptables-multiport[name=ReqLimit, port="http,https", protocol=tcp]
logpath = /var/log/nginx/error.log
findtime = 600
bantime = 7200
maxretry = 10
```

```bash
# Fail2ban'ƒ± ba≈ülat
sudo systemctl enable fail2ban
sudo systemctl start fail2ban

# Status kontrol et
sudo fail2ban-client status
```

---

## üìä Monitoring ve Backup

### 1. Log Monitoring

```bash
# Log dosyalarƒ±nƒ± kontrol et
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
sudo journalctl -u document-management -f

# Logrotate konfig√ºrasyonu
sudo nano /etc/logrotate.d/document-management
```

```
/var/www/document-management/api/logs/*.txt {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 www-data www-data
}
```

### 2. Backup Script

```bash
# Backup script olu≈ütur
sudo nano /home/ubuntu/backup.sh
```

```bash
#!/bin/bash

# Backup Configuration
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/home/ubuntu/backups"
DB_NAME="DocumentManagementDB"
DB_USER="docuser"
DB_PASS="VeryStrongPassword123!"
UPLOADS_DIR="/var/www/document-management/api/uploads"

# Create backup directory
mkdir -p $BACKUP_DIR

# Database backup
mysqldump -u$DB_USER -p$DB_PASS $DB_NAME | gzip > $BACKUP_DIR/db_$DATE.sql.gz

# Files backup
tar -czf $BACKUP_DIR/files_$DATE.tar.gz -C $(dirname $UPLOADS_DIR) $(basename $UPLOADS_DIR)

# Clean old backups (keep 7 days)
find $BACKUP_DIR -name "db_*.sql.gz" -mtime +7 -delete
find $BACKUP_DIR -name "files_*.tar.gz" -mtime +7 -delete

echo "Backup completed: $DATE"
```

```bash
# Script'i executable yap
chmod +x /home/ubuntu/backup.sh

# Crontab'a g√ºnl√ºk backup ekle
crontab -e
# ≈ûu satƒ±rƒ± ekle:
# 0 2 * * * /home/ubuntu/backup.sh >> /home/ubuntu/backup.log 2>&1
```

### 3. Health Check Script

```bash
# Health check script olu≈ütur
sudo nano /home/ubuntu/health-check.sh
```

```bash
#!/bin/bash

# Health check
API_URL="http://localhost:5000/api"
SERVICE_NAME="document-management"

# Check API
if ! curl -f -s $API_URL/health > /dev/null; then
    echo "API is down, restarting service..."
    sudo systemctl restart $SERVICE_NAME
    
    # Wait and check again
    sleep 10
    if ! curl -f -s $API_URL/health > /dev/null; then
        echo "Service restart failed!" | mail -s "API Alert" your-email@domain.com
    fi
fi

# Check disk space
DISK_USAGE=$(df / | tail -1 | awk '{print $5}' | sed 's/%//')
if [ $DISK_USAGE -gt 80 ]; then
    echo "Disk usage is ${DISK_USAGE}%" | mail -s "Disk Alert" your-email@domain.com
fi
```

```bash
# Script'i executable yap
chmod +x /home/ubuntu/health-check.sh

# Crontab'a 5 dakikada bir health check ekle
crontab -e
# ≈ûu satƒ±rƒ± ekle:
# */5 * * * * /home/ubuntu/health-check.sh
```

---

## üöÄ Final Test ve Doƒürulama

### 1. Servis Durumlarƒ±nƒ± Kontrol Et

```bash
# T√ºm servislerin durumunu kontrol et
sudo systemctl status nginx
sudo systemctl status mysql
sudo systemctl status document-management

# Port'larƒ±n a√ßƒ±k olduƒüunu kontrol et
sudo netstat -tlnp | grep -E ':80|:443|:3306|:5000'
```

### 2. API Test

```bash
# Health check
curl http://localhost:5000/health
curl https://yourdomain.com/api/health

# Login test
curl -X POST https://yourdomain.com/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"superadmin","password":"12345"}'
```

### 3. Frontend Test

```bash
# Frontend eri≈üim test
curl -I https://yourdomain.com
curl -I http://your-vps-ip
```

---

## üéØ Deployment Checklist

### Pre-Deployment
- [ ] Oracle VPS instance olu≈üturuldu
- [ ] Domain DNS ayarlarƒ± yapƒ±ldƒ±
- [ ] SSH key'leri ayarlandƒ±

### System Setup
- [ ] Ubuntu g√ºncellemeleri yapƒ±ldƒ±
- [ ] .NET 8 runtime y√ºklendi
- [ ] Node.js y√ºklendi
- [ ] Nginx y√ºklendi
- [ ] MySQL y√ºklendi ve konfig√ºre edildi

### Application Deployment
- [ ] Backend build edildi ve deploy edildi
- [ ] Frontend build edildi ve deploy edildi
- [ ] Database migration √ßalƒ±≈ütƒ±rƒ±ldƒ±
- [ ] Systemd service olu≈üturuldu ve √ßalƒ±≈üƒ±yor

### Security & SSL
- [ ] Firewall konfig√ºre edildi
- [ ] SSL certificate kuruldu
- [ ] Security headers ayarlandƒ±
- [ ] Fail2ban kuruldu

### Monitoring & Backup
- [ ] Log monitoring ayarlandƒ±
- [ ] Backup script'i olu≈üturuldu ve crontab'a eklendi
- [ ] Health check script'i ayarlandƒ±

### Final Tests
- [ ] API endpoints test edildi
- [ ] Frontend eri≈üilebilir
- [ ] SSL certificate √ßalƒ±≈üƒ±yor
- [ ] File upload/download test edildi
- [ ] Authentication flow test edildi

---

## üîß Troubleshooting

### Yaygƒ±n Sorunlar

#### 1. .NET Service Ba≈ülamƒ±yor
```bash
# Logs kontrol et
sudo journalctl -u document-management -n 50

# Permissions kontrol et
sudo chown -R www-data:www-data /var/www/document-management

# Port kullanƒ±mƒ±nƒ± kontrol et
sudo netstat -tlnp | grep :5000
```

#### 2. Nginx 502 Bad Gateway
```bash
# Backend service √ßalƒ±≈üƒ±yor mu?
sudo systemctl status document-management

# Nginx error logs
sudo tail -f /var/log/nginx/error.log

# Proxy ayarlarƒ±nƒ± kontrol et
sudo nginx -t
```

#### 3. Database Connection Error
```bash
# MySQL √ßalƒ±≈üƒ±yor mu?
sudo systemctl status mysql

# Connection test
mysql -u docuser -p DocumentManagementDB

# Firewall MySQL portunu engelliyor mu?
sudo ufw status
```

#### 4. SSL Certificate Sorunlarƒ±
```bash
# Certificate durumu
sudo certbot certificates

# Renewal test
sudo certbot renew --dry-run

# Nginx SSL config test
sudo nginx -t
```

---

## üí° Performance Optimizasyonu

### 1. Nginx Caching

```bash
# Nginx cache konfig√ºrasyonu ekle
sudo nano /etc/nginx/nginx.conf
```

```nginx
http {
    # Cache zone tanƒ±mla
    proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=api_cache:10m max_size=1g inactive=60m use_temp_path=off;
    
    # Gzip compression
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;
}
```

### 2. MySQL Optimizasyonu

```bash
# MySQL konfig√ºrasyonu
sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf
```

```ini
[mysqld]
# Performance optimizations
innodb_buffer_pool_size = 256M
innodb_log_file_size = 64M
query_cache_type = 1
query_cache_size = 32M
max_connections = 100
```

### 3. System Monitoring

```bash
# htop y√ºkle
sudo apt install -y htop

# System resource monitoring
htop
iostat -x 1
free -h
df -h
```

---

Bu rehber ile Oracle VPS'te Ubuntu √ºzerinde Document Management System'i ba≈üarƒ±yla canlƒ±ya alabilirsin! Her adƒ±mƒ± dikkatli takip et ve sorun ya≈üarsan troubleshooting b√∂l√ºm√ºne bak.

**√ñnemli**: Production'da mutlaka g√º√ßl√º ≈üifreler kullan ve g√ºvenlik g√ºncellemelerini takip et! üîí